-- Allow restaurants to enable/disable pickup
ALTER TABLE Restaurants
  ADD COLUMN supports_pickup TINYINT(1) DEFAULT 1;

-- Add order_type, pickup_eta_minutes, and pickup_requested_at to Orders table
ALTER TABLE Orders
  ADD COLUMN order_type ENUM('DINE_IN','PICKUP','DELIVERY') DEFAULT 'DINE_IN' AFTER order_group_id,
  ADD COLUMN pickup_eta_minutes INT DEFAULT NULL AFTER order_type,
  ADD COLUMN pickup_requested_at DATETIME DEFAULT NULL AFTER pickup_eta_minutes;


DROP TABLE IF EXISTS `area`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `area` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(191) NOT NULL,
  `description` varchar(191) DEFAULT NULL,
  `restaurantId` bigint(20) unsigned NOT NULL,
  `createdAt` datetime(3) NOT NULL DEFAULT current_timestamp(3),
  `updatedAt` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `fk_area_restaurant` (`restaurantId`),
  CONSTRAINT `fk_area_restaurant` FOREIGN KEY (`restaurantId`) REFERENCES `restaurants` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `area`
--

LOCK TABLES `area` WRITE;
/*!40000 ALTER TABLE `area` DISABLE KEYS */;
INSERT INTO `area` VALUES
(1,'Main Dining','Primary indoor seating area',1,'2025-05-24 13:00:16.343','2025-05-24 07:30:16'),
(2,'Patio','Outdoor seating with garden view',1,'2025-05-24 13:00:16.343','2025-05-24 07:30:16'),
(3,'Bar Area','Seating by the bar counter',1,'2025-05-24 13:00:16.343','2025-05-24 07:30:16'),
(4,'Private Room','VIP section for special occasions',1,'2025-05-24 13:00:16.343','2025-05-24 07:30:16'),
(5,'Terrace','Rooftop seating with city views',2,'2025-05-24 13:00:16.343','2025-05-24 07:30:16'),
(6,'Ground Floor','Standard dining area',2,'2025-05-24 13:00:16.343','2025-05-24 07:30:16'),
(7,'Family Section','Area with kid-friendly seating',3,'2025-05-24 13:00:16.343','2025-05-24 07:30:16');
/*!40000 ALTER TABLE `area` ENABLE KEYS */;
UNLOCK TABLES;

UPDATE users
SET roleId = 1
WHERE roleId IS NULL;


DROP TABLE IF EXISTS `roles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `roles` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `description` text DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `roles`
--

LOCK TABLES `roles` WRITE;
/*!40000 ALTER TABLE `roles` DISABLE KEYS */;
INSERT INTO `roles` VALUES
(1,'Admin','Administrator with full access','2025-05-24 03:24:44','2025-05-24 03:24:44'),
(2,'Manager','Restaurant manager with limited access','2025-05-24 03:24:44','2025-05-24 03:24:44'),
(3,'Staff','Staff member with basic access','2025-05-24 03:24:44','2025-05-24 03:24:44'),
(4,'Admin','Administrator with full access','2025-05-24 03:29:02','2025-05-24 03:29:02'),
(5,'Manager','Restaurant manager with limited access','2025-05-24 03:29:02','2025-05-24 03:29:02'),
(6,'Staff','Staff member with basic access','2025-05-24 03:29:02','2025-05-24 03:29:02');
/*!40000 ALTER TABLE `roles` ENABLE KEYS */;
UNLOCK TABLES;

DROP TABLE IF EXISTS `table`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `table` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `number` varchar(191) NOT NULL,
  `capacity` int(11) NOT NULL,
  `status` enum('AVAILABLE','OCCUPIED','RESERVED','MAINTENANCE') NOT NULL DEFAULT 'AVAILABLE',
  `restaurantId` bigint(20) unsigned NOT NULL,
  `areaId` bigint(20) unsigned NOT NULL,
  `createdAt` datetime(3) NOT NULL DEFAULT current_timestamp(3),
  `updatedAt` datetime(3) NOT NULL DEFAULT current_timestamp(3) ON UPDATE current_timestamp(3),
  PRIMARY KEY (`id`),
  UNIQUE KEY `Table_number_restaurantId_key` (`number`,`restaurantId`),
  KEY `Table_restaurantId_fkey` (`restaurantId`),
  KEY `Table_areaId_fkey` (`areaId`),
  CONSTRAINT `Table_areaId_fkey` FOREIGN KEY (`areaId`) REFERENCES `area` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `Table_restaurantId_fkey` FOREIGN KEY (`restaurantId`) REFERENCES `restaurants` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

ALTER TABLE area MODIFY id BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT;

ALTER TABLE users
ADD CONSTRAINT fk_users_roleId
FOREIGN KEY (roleId) REFERENCES roles(id)
ON UPDATE CASCADE;

-- Add missing fields from the older schema
ALTER TABLE `restaurants`
ADD COLUMN `category` VARCHAR(100) AFTER `payment_acceptance_type`,
ADD COLUMN `subcategory` VARCHAR(100) AFTER `category`,
ADD COLUMN `size` VARCHAR(50) AFTER `subcategory`,
ADD COLUMN `area_sqft` DECIMAL(10,2) AFTER `size`,
ADD COLUMN `pax` INT(11) AFTER `area_sqft`,
ADD COLUMN `floors` INT(11) AFTER `pax`,
ADD COLUMN `created_by_user_id` BIGINT(20) UNSIGNED AFTER `floors`;

-- Add foreign key constraint for created_by_user_id (assuming `users(id)` exists)
ALTER TABLE `restaurants`
ADD CONSTRAINT `restaurants_created_by_user_id_fk`
FOREIGN KEY (`created_by_user_id`) REFERENCES `users`(`id`)
ON UPDATE CASCADE
ON DELETE SET NULL;

ALTER TABLE users
ADD COLUMN roleId INT(11) NOT NULL DEFAULT 1;
UPDATE users
SET roleId = 1;

-- Add razorpay_account_id to Restaurants
ALTER TABLE Restaurants ADD COLUMN razorpay_account_id VARCHAR(64) DEFAULT NULL AFTER menu_sharing_code;




  
